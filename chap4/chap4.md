# 第4章 プロセススケジューラ

## プロセススケジューラ

Linuxは、プロセススケジューラにより複数プロセスを並行して動作させる。

- Linuxでは、マルチコアCPUの1コアが1つのCPU（論理CPU）として認識される
- 1つのCPU上で同時に実行されるプロセスは1つのみ
- 1つのCPU上で複数プロセスを実行する場合、各プロセスを適当な時間長（タイムスライス）で切り替えて順次実行する
- 1つのCPU上におけるタイムスライスは、ローテーションで切り替わり順次実行される（ラウンドロビン方式）。各タイムスライスはほぼ等しい長さの時間長となる

## コンテキストスイッチ

複数のプロセスが単一のCPUを共有できるように、CPUの状態（コンテキスト）を保存・復元する過程。

## プロセスの状態

`ps ax`で確認できるプロセスの状態には次のようなものがある。

| 状態（STATフィールド値） | 概要 |
| :- | :- |
| 実行状態 (O) | 論理CPUで実行中 |
| 実行可能状態 (R) | CPU時間の割当を待機中 |
| アイドル状態 (I) | プロセスを作成中 |
| スリープ状態 (S/D) | I/Oなどイベントの発生待ち。発生までCPU時間を使わない |
| ゾンビ状態 (Z) | プロセスが終了し、終了ステータスが読まれるのを待機中 |

プロセスは、生成されてからその終了までに実行状態/実行可能状態/スリープ状態を適宜遷移する。

### スリープ状態

- S ... シグナルによって実行状態に戻るもの
- D ... 上記でないもの。ストレージデバイスのアクセス待ちなど

### ゾンビ状態

通常ゾンビ状態となるのはプロセスの終了直後、プロセスの終了ステータスが検知されるまでの短い時間であるが、何らかの不具合によりこの状態が続くとメモリが開放されないままとなる（ゾンビプロセス）。

### アイドル状態

論理CPUは動作しないときアイドル状態として、特殊命令により休止状態となり消費電力を抑えている。

## コマンド

### `taskset`

指定したIDの論理CPUでプロセスを実行する。

```sh
$ taskset -c 0,3 [command]
```

### `ps`

現在のプロセスを確認する。

```sh
$ ps ax | wc -l
```
