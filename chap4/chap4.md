# 第4章 プロセススケジューラ

## プロセススケジューラ

Linuxは、プロセススケジューラにより複数プロセスを並行して動作させる。

- Linuxでは、マルチコアCPUの1コアが1つのCPU（論理CPU）として認識される
- 1つのCPU上で同時に実行されるプロセスは1つのみ
- 1つのCPU上で複数プロセスを実行する場合、各プロセスを適当な時間長（タイムスライス）で切り替えて順次実行する
- 1つのCPU上におけるタイムスライスは、ローテーションで切り替わり順次実行される（ラウンドロビン方式）。各タイムスライスはほぼ等しい長さの時間長となる

## コンテキストスイッチ

複数のプロセスが単一のCPUを共有できるように、CPUの状態（コンテキスト）を保存・復元する過程。

## プロセスの状態

`ps ax`で確認できるプロセスの状態には次のようなものがある。

| 状態（STATフィールド） | 概要 |
| :- | :- |
| 実行状態 (R) | 論理CPUを使用中 |
| 実行待ち状態 (R) | CPU時間の割当を待機中 |
| スリープ状態 (S/D) | イベントの発生待ち。発生までCPU時間を使わない |
| ゾンビ状態 (Z) | 終了しているがプロセステーブルにエントリが存在する |

ゾンビ状態は、プロセスが終了しているがそれをまだ検知できていない状態。
正常な状態では、プロセスの終了直後、親プロセスが子プロセスの終了ステータスを取得するまでの間ゾンビ状態となるが、子プロセスの終了状態を親プロセスが正常に検知できないときこのままとなる。

## コマンド

### `taskset`

指定したIDの論理CPUでプロセスを実行する。

```sh
$ taskset -c 0,3 [command]
```

### `ps`

現在のプロセスを確認する。

```sh
$ ps ax | wc -l
```
